{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "presets.schema.json",
  "title": "Preset Definitions Schema",
  "description": "Schema for validating preset configurations used by the /github-setup skill",
  "type": "object",
  "required": ["version", "presets"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema file"
    },
    "version": {
      "type": "string",
      "description": "Schema version (semver format)",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "generated": {
      "type": "string",
      "description": "Date when this file was generated (YYYY-MM-DD)",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "presets": {
      "type": "object",
      "description": "Map of preset IDs to their configurations",
      "additionalProperties": {
        "$ref": "#/$defs/preset"
      }
    },
    "detection_priority": {
      "type": "array",
      "description": "Ordered list of preset IDs for detection (first match wins)",
      "items": {
        "type": "string"
      }
    },
    "wizard": {
      "$ref": "#/$defs/wizard"
    }
  },
  "$defs": {
    "preset": {
      "type": "object",
      "description": "A preset configuration for project setup",
      "required": ["name", "description", "category", "templates"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable name of the preset",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Brief description of what this preset provides",
          "minLength": 1
        },
        "category": {
          "type": "string",
          "description": "Category for grouping presets",
          "enum": [
            "language",
            "mobile",
            "feature",
            "deployment",
            "notifications",
            "game-dev",
            "specialized"
          ]
        },
        "detection": {
          "oneOf": [
            { "type": "null" },
            { "$ref": "#/$defs/detection" }
          ],
          "description": "Rules for auto-detecting if this preset applies to a project"
        },
        "templates": {
          "type": "array",
          "description": "List of template files to install",
          "items": {
            "$ref": "#/$defs/templateMapping"
          }
        },
        "commonly_paired_with": {
          "type": "array",
          "description": "Preset IDs that are often used together with this one",
          "items": {
            "type": "string"
          }
        },
        "conflicts_with": {
          "type": "array",
          "description": "Preset IDs that conflict with this one (cannot be used together)",
          "items": {
            "type": "string"
          }
        },
        "secrets": {
          "$ref": "#/$defs/secrets"
        }
      }
    },
    "detection": {
      "type": "object",
      "description": "Auto-detection configuration for a preset",
      "properties": {
        "files": {
          "type": "array",
          "description": "Files that indicate this preset should be used (glob patterns allowed)",
          "items": {
            "type": "string"
          }
        },
        "exclude": {
          "type": "array",
          "description": "Files that exclude this preset even if detection files match",
          "items": {
            "type": "string"
          }
        },
        "content_match": {
          "type": "object",
          "description": "File content patterns to match (filename -> regex pattern)",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    },
    "templateMapping": {
      "type": "object",
      "description": "Mapping of a template file to its destination",
      "required": ["source", "dest"],
      "properties": {
        "source": {
          "type": "string",
          "description": "Path to the template file (relative to templates/)"
        },
        "dest": {
          "type": "string",
          "description": "Destination path in the target repository"
        },
        "merge": {
          "type": "boolean",
          "description": "If true, merge with existing file instead of overwriting",
          "default": false
        },
        "condition": {
          "type": "string",
          "description": "Condition for when to include this template (e.g., file presence check)"
        }
      }
    },
    "secrets": {
      "type": "object",
      "description": "Secrets configuration for this preset",
      "properties": {
        "required": {
          "type": "array",
          "description": "Secrets that must be configured for the preset to work",
          "items": {
            "$ref": "#/$defs/secret"
          }
        },
        "optional": {
          "type": "array",
          "description": "Secrets that enable additional functionality",
          "items": {
            "$ref": "#/$defs/secret"
          }
        }
      }
    },
    "secret": {
      "type": "object",
      "description": "A secret configuration",
      "required": ["name", "description"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the secret (e.g., NPM_TOKEN)"
        },
        "description": {
          "type": "string",
          "description": "Description of what this secret is for"
        },
        "setup_url": {
          "type": "string",
          "description": "URL with instructions to obtain this secret",
          "format": "uri"
        }
      }
    },
    "wizard": {
      "type": "object",
      "description": "Interactive wizard configuration",
      "properties": {
        "essential_questions": {
          "type": "array",
          "description": "Questions always asked during interactive setup",
          "items": {
            "$ref": "#/$defs/wizardQuestion"
          }
        },
        "tier2_questions": {
          "type": "array",
          "description": "Additional questions shown when user opts for more options",
          "items": {
            "$ref": "#/$defs/wizardQuestion"
          }
        }
      }
    },
    "wizardQuestion": {
      "type": "object",
      "description": "A question in the interactive wizard",
      "required": ["id", "question", "type", "options"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this question"
        },
        "question": {
          "type": "string",
          "description": "The question text to display to the user"
        },
        "type": {
          "type": "string",
          "description": "Type of question input",
          "enum": ["confirm", "single", "multi"]
        },
        "options": {
          "type": "array",
          "description": "Available answer options (strings for confirm type, objects for single/multi)",
          "items": {
            "oneOf": [
              { "type": "string" },
              { "$ref": "#/$defs/wizardOption" }
            ]
          }
        }
      }
    },
    "wizardOption": {
      "type": "object",
      "description": "An option for a wizard question",
      "required": ["label"],
      "properties": {
        "label": {
          "type": "string",
          "description": "Display text for this option"
        },
        "value": {
          "description": "Value to use when this option is selected (preset ID or null)",
          "oneOf": [
            { "type": "string" },
            { "type": "null" }
          ]
        },
        "description": {
          "type": "string",
          "description": "Additional explanation of this option"
        }
      }
    }
  }
}
