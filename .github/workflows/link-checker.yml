# Link Checker Workflow
# Finds broken links in documentation

name: Link Checker

on:
  push:
    branches: [main]
    paths:
      - "**.md"
      - ".github/workflows/link-checker.yml"
  pull_request:
    branches: [main]
    paths:
      - "**.md"
      - ".github/workflows/link-checker.yml"
  # Run weekly to catch external link rot
  schedule:
    - cron: "0 0 * * 0" # Every Sunday at midnight

  workflow_dispatch:

jobs:
  link-check:
    name: Check Links
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check links
        uses: lycheeverse/lychee-action@v2
        with:
          args: >-
            --verbose
            --no-progress
            --accept 200,204,206,301,302,307,308,403
            --exclude "^https://github.com/domelic/github-repository-setup/(edit|new|delete)"
            --exclude "^https://github.com/.*/(compare|commits)"
            --exclude "^https://github.com/serena-ai/serena"
            --exclude "^https://www.zotero.org/settings"
            "**/*.md"
          fail: true

      - name: Create Issue on Failure
        if: failure() && github.event_name == 'schedule'
        uses: peter-evans/create-issue-from-file@v5
        with:
          title: "Link Checker: Broken links detected"
          content-filepath: ./lychee/out.md
          labels: bug,documentation
